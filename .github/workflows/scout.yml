name: Global-Macro-Scout

on:
  schedule:
    # ì‚¬ë ¹ê´€ë‹˜, 20ë¶„ ê°„ê²© ìœ ì‹¤ ë°©ì§€ë¥¼ ìœ„í•´ ì œì•ˆë“œë¦° í¬ë¡ ì‹ì…ë‹ˆë‹¤. (í•„ìš”ì‹œ '0 */1 * * *'ë¡œ ë³µêµ¬ ê°€ëŠ¥)
    - cron: '*/5 * * * *'
  workflow_dispatch:

# ğŸš¨ [ì‹ ê·œ] ê°™ì€ ì •ì°° ì‘ì „ì´ ê²¹ì¹˜ì§€ ì•Šê²Œ ë°©ì–´ë§‰ì„ ì¹©ë‹ˆë‹¤.
concurrency:
  group: macro-scouting
  cancel-in-progress: true

jobs:
  run-scout:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout
        uses: actions/checkout@v3
        with:
          # ğŸš¨ [ì¤‘ìš”] ëª¨ë“  íˆìŠ¤í† ë¦¬ë¥¼ ê°€ì ¸ì™€ì•¼ ì•ˆì „í•˜ê²Œ í•©ì¹ (Rebase) ìˆ˜ ìˆìŠµë‹ˆë‹¤.
          fetch-depth: 0

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install
        # ğŸš¨ [ì¤‘ìš”] ë‚ ì§œ ì„¸íƒì„ ìœ„í•´ python-dateutilì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.
        run: pip install requests beautifulsoup4 pandas python-dateutil

      - name: Run
        # ì‹¤í–‰í•  íŒŒì¼ëª…ì´ 'scout_jp.py'ê°€ ë§ëŠ”ì§€ í•œ ë²ˆ ë” í™•ì¸í•˜ì‹­ì‹œì˜¤!
        run: python scout_jp.py

      - name: Push
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          
          # 1. ë³€ê²½ì‚¬í•­ ìŠ¤í…Œì´ì§•
          git add macro_intelligence.db
          
          # 2. ì»¤ë°‹ (ë³€ê²½ì‚¬í•­ ì—†ìœ¼ë©´ í†µê³¼)
          git diff --quiet && git diff --staged --quiet || git commit -m "ğŸ“¡ ì •ì°° ë³´ê³ : DB ì—…ë°ì´íŠ¸ ($(date +'%Y-%m-%d %H:%M'))"
          
          # 3. ğŸš¨ [í•µì‹¬] ì›ê²© ê¸°ì§€ì˜ ìµœì‹  ìƒíƒœë¥¼ ê°€ì ¸ì™€ì„œ ë‚´ ì‘ì—…ë¬¼ì„ ê·¸ ìœ„ì— ì–¹ìŠµë‹ˆë‹¤.
          git pull --rebase origin main
          
          # 4. ì´ì œ ì•ˆì „í•˜ê²Œ ë°€ì–´ë„£ê¸°
          git push origin main
